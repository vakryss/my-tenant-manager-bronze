<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Tenant Manager – Bronze</title>

  <!-- HARD BLOCK RENDERING BEFORE JS -->
  <style>
    html {
      visibility: hidden;
    }
  </style>

  <!-- AUTH GATE RUNS BEFORE PAGE SHOWS -->
  <script type="module">
    import { supabase } from "./scripts/supabase.js";

    const { data: { session } } = await supabase.auth.getSession();

    if (!session) {
      window.location.replace("/login.html");
    } else {
      // Auth confirmed — allow render
      document.documentElement.style.visibility = "visible";
    }
  </script>
</head>

<body>

  <h1>My Tenant Manager</h1>
  <p>Bronze Tier</p>

  <button id="testBtn">Test Supabase Connection</button>
  <p id="result">N/A</p>

  <button id="logoutBtn">Logout</button>

  <script type="module">
    import { supabase } from "./scripts/supabase.js";
    import { logout } from "./scripts/session.js";

    /* ---- Supabase Connection Test ---- */
    document.getElementById("testBtn").addEventListener("click", async () => {
      const { error } = await supabase.auth.getSession();
      document.getElementById("result").textContent =
        error ? "Error: " + error.message : "Supabase connected successfully.";
    });

    /* ---- Logout ---- */
    document.getElementById("logoutBtn").addEventListener("click", logout);
  </script>

</body>
</html>
